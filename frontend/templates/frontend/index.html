{% load static %}
<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Genffice</title>
    <link rel="stylesheet" href="{% static 'frontend/style.css' %}">
  </head>
  <body>
    <!-- LOGIN -->
    <div id="login" class="login-wrap card">
      <h2 style="margin: 0 0 10px">–í—Ö–æ–¥ –≤ Genffice</h2>
      <div class="field">
        <input id="username" class="input" placeholder="username" />
      </div>
      <div class="field">
        <input
          id="password"
          type="password"
          class="input"
          placeholder="password"
        />
      </div>
      <div class="row">
        <button class="btn" onclick="login()">–í–æ–π—Ç–∏</button>
        <div id="loginError" class="error"></div>
      </div>
    </div>

    <!-- APP -->
    <div id="app" style="display: none">
      <div class="topbar">
        <div class="brand">Genffice</div>
        <div class="spacer"></div>
        <input id="docName" class="docname" placeholder="–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è" />
        <div class="user">
          <span class="dot"></span><span id="who" class="muted"></span>
        </div>
        <button class="btn" onclick="logout()">–í—ã–π—Ç–∏</button>
      </div>

      <div class="ribbon">
        <div class="group">
          <select id="block" class="select" onchange="applyBlock(this.value)">
            <option value="P">–ê–±–∑–∞—Ü</option>
            <option value="H1">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 1</option>
            <option value="H2">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 2</option>
            <option value="H3">–ó–∞–≥–æ–ª–æ–≤–æ–∫ 3</option>
            <option value="PRE">–ö–æ–¥</option>
          </select>
          <button class="btn tog" id="bBold" onclick="cmd('bold',this)">
            B
          </button>
          <button class="btn tog" id="bIt" onclick="cmd('italic',this)">
            <i>I</i>
          </button>
          <button class="btn tog" id="bUn" onclick="cmd('underline',this)">
            <u>U</u>
          </button>
        </div>

        <div class="group">
          <button class="btn" onclick="cmd('insertUnorderedList')">
            ‚Ä¢ –°–ø–∏—Å–æ–∫
          </button>
          <button class="btn" onclick="cmd('insertOrderedList')">
            1. –°–ø–∏—Å–æ–∫
          </button>
          <button class="btn" onclick="makeLink()">–°—Å—ã–ª–∫–∞</button>
        </div>

        <div class="group">
          <button class="btn" onclick="saveDoc()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          <button class="btn" onclick="newDoc()">‚ûï –ù–æ–≤—ã–π</button>
          <button class="btn" onclick="deleteDoc()">üóë –£–¥–∞–ª–∏—Ç—å</button>
          <button class="btn" onclick="copyDocLink()">
            üîó –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
          </button>
        </div>

        <div class="group">
          <button class="btn" onclick="exportPDF()">‚¨áÔ∏è PDF</button>
          <button class="btn" onclick="exportDOCX()">‚¨áÔ∏è DOCX</button>
          <button class="btn" onclick="addPageBreak()">–†–∞–∑—Ä—ã–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</button>
          <button class="btn" id="togglePaged" onclick="togglePaged()">
            üìÑ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä–∞–Ω–∏—Ü
          </button>
          <button
            class="btn"
            id="refreshPaged"
            onclick="renderPages()"
            style="display: none"
          >
            ‚Üª –û–±–Ω–æ–≤–∏—Ç—å
          </button>
        </div>

        <div class="spacer"></div>
        <div class="group" style="border-right: none">
          <span class="muted">–î–æ–∫—É–º–µ–Ω—Ç—ã</span>
        </div>
      </div>

      <div class="wrap">
        <div class="card editor-scroll">
          <div class="page">
            <div id="editor" class="editor" contenteditable="true"></div>
          </div>
          <div id="pagesPreview" class="pages" style="display: none"></div>
        </div>

        <div class="card sidebar">
          <div class="side-head">
            <strong>GEN AI</strong
            ><span class="pill">–í –±—É–¥—É—â–µ–µ –≤–º–µ—Å—Ç–µ —Å –Ω–∞–º–∏!</span>
            <span class="muted" style="margin-left: auto">/api/ai</span>
          </div>
          <div class="side-body">
            <textarea
              id="prompt"
              class="text"
              placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ¬´–°–¥–µ–ª–∞–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –±–µ–∑ –∫–æ–º–ø–∞–Ω–∏–π –∏ –±—é–¥–∂–µ—Ç–æ–≤, —Ç–æ–ª—å–∫–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏¬ª"
            ></textarea>
            <div class="row">
              <button class="btn" onclick="runAI()">–û—Ç–≤–µ—Ç</button>
              <button class="btn" onclick="insertAIToDoc()">–í—Å—Ç–∞–≤–∏—Ç—å</button>
            </div>
            <div class="muted">–†–µ–∑—É–ª—å—Ç–∞—Ç (Markdown):</div>
            <div id="aiOutput" class="out"></div>
            <div class="muted">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä (Markdown ‚Üí HTML):</div>
            <div id="aiPreview" class="out"></div>
            <div class="muted">–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:</div>
            <div id="aiReason" class="out"></div>
            <div class="row">
              <button class="btn" onclick="clearAI()">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div class="muted">–ú–æ–∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã</div>
            <div id="docsList" class="list"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- deps -->
    <script src="{% static 'frontend/app.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/html-docx-js/0.3.1/html-docx.js"
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-funnel@4"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js"></script>
    <script>
      mermaid.initialize({ startOnLoad: false, securityLevel: "loose" });
    </script>
  </body>
</html>
